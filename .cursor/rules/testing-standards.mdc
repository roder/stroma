---
description: Test-Driven Development standards using nextest with 100% coverage and deterministic behavior
globs: **/*.rs
alwaysApply: false
---

# Testing Standards for Stroma

**Canonical Source**: `.beads/testing-standards.bead`

Complete TDD workflow, property-based testing, integration testing patterns, and domain-specific test requirements are defined in the testing-standards bead. Read that file for complete specifications.

## Core Requirements

| Requirement | Status |
|-------------|--------|
| TDD (test-first) | REQUIRED for entire project |
| 100% code coverage | REQUIRED (enforced in CI) |
| Property-based tests | REQUIRED for trust-critical code |
| Deterministic tests | REQUIRED (fixed seeds, mock time) |

## Property-Based Testing (CRITICAL)

Use `proptest` crate for all trust-critical code:
- HMAC determinism
- Standing calculation
- Ejection invariants
- Vouch/flag commutativity

## Integration Testing

| Layer | Signal | Freenet |
|-------|--------|---------|
| Unit | MockSignalClient | `Executor::new_mock_in_memory()` |
| Integration | Mock + Recording | `SimNetwork` |
| E2E | Manual (pre-release) | Local node |

## Anti-Patterns

- ❌ Tests requiring real Signal accounts
- ❌ Skipping property tests for trust-critical code
- ❌ Direct Signal/Freenet calls without trait abstraction
- ❌ Non-deterministic tests (random data, real time)
