---
description: Freenet contract development patterns using ComposableState and summary-delta synchronization
globs: **/*contract*.rs,**/*freenet*.rs,**/*state*.rs
alwaysApply: false
---

# Freenet Contract Design Standards

**Canonical Source**: `.beads/freenet-contract-design.bead`

The complete Freenet contract design patterns, ComposableState implementation, mergeable state structures, and spike week findings are defined in the freenet-contract-design bead. Read that file for complete specifications.

## Key Principles

- **Mergeable State**: Use BTreeSet, HashMap (not Vec, MerkleTree as primary storage)
- **Commutative Deltas**: Order of delta application must not affect final state
- **Set-Based Storage**: `members: BTreeSet<Hash>`, `vouches: HashMap<Hash, HashSet<Hash>>`
- **On-Demand Merkle**: Generate Merkle trees when needed (0.09ms at 1000 members)

## Spike Week Summary

| Q | Status | Key Finding |
|---|--------|-------------|
| Q1 | GO | Set-based state with tombstones (commutative) |
| Q2 | GO | Contract CAN enforce invariants |
| Q3 | GO | Bridge Removal for cluster detection |
| Q4 | PARTIAL | Bot-side STARK verification |
| Q5 | GO | On-demand Merkle (sub-ms) |
| Q6 | COMPLETE | Store outcomes only |

## References

- [freenet-stdlib docs.rs](https://docs.rs/freenet-stdlib)
- [freenet crate docs.rs](https://docs.rs/freenet)
- `docs/spike/q1/RESULTS.md` through `docs/spike/q6/RESULTS.md`
