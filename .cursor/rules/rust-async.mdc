---
description: Async programming patterns and concurrency standards for Stroma using tokio
globs: **/*.rs
alwaysApply: false
---

# Rust Async Programming Standards

**Canonical Source**: `.beads/rust-async.bead`

Complete async programming patterns, tokio usage, channel types, shared state management, and Stroma-specific event-driven patterns are defined in the rust-async bead. Read that file for complete specifications.

## Key Patterns

- **Runtime**: Use `tokio` with `features = ["full"]`
- **CPU Work**: Use `spawn_blocking` for STARK proofs
- **Cancellation**: Use `tokio::select!` for graceful shutdown
- **State Stream**: Real-time subscription (NEVER poll)

## Anti-Patterns

- ❌ Don't block in async context (`std::thread::sleep`)
- ❌ Don't hold locks across await points
- ❌ Don't ignore cancellation
- ❌ Don't poll for state changes

## Related Beads

- `.beads/freenet-integration.bead` - State stream patterns
- `.beads/signal-integration.bead` - Event loop patterns
